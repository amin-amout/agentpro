{
  "systemOverview": {
    "name": "LocalNetChat",
    "description": "A lightweight, cross\u2011platform desktop/mobile chat application that operates entirely within a local subnet using peer\u2011to\u2011peer communication. It provides instant messaging, status broadcasting, and file sharing up to 50\u202fMB without any external servers or internet connectivity.",
    "corePrinciples": [
      "No external network traffic \u2013 all traffic is confined to the LAN.",
      "Zero\u2011configuration \u2013 automatic peer discovery and self\u2011signed TLS certificates.",
      "High performance \u2013 sub\u2011200\u202fms latency for messages, <5\u202fs transfer for 50\u202fMB on 100\u202fMbps LAN.",
      "Privacy\u2011first \u2013 local persistence only, GDPR compliant."
    ],
    "targetAudience": [
      "Small teams",
      "Classrooms",
      "Any environment with a shared local network"
    ],
    "platforms": [
      "Windows",
      "macOS",
      "Linux",
      "Android",
      "iOS"
    ],
    "deploymentModel": "Peer\u2011to\u2011peer with optional local bootstrap host discovery (mDNS/UDP)."
  },
  "componentArchitecture": [
    {
      "name": "DiscoveryService",
      "role": "Automatically discovers peers on the same subnet.",
      "protocol": "mDNS/UDP broadcast",
      "operations": [
        "Broadcast presence packet every 5\u202fs",
        "Listen for presence packets from other peers",
        "Maintain active peer list with TTL"
      ],
      "platformSpecifics": {
        "desktop": "Java\u00a0NIO + JmDNS",
        "mobile": "MulticastSocket (Android) / NetworkExtension (iOS)"
      }
    },
    {
      "name": "ConnectionManager",
      "role": "Handles TCP/TLS connections between peers.",
      "protocol": "TLS\u00a01.3 over TCP sockets",
      "operations": [
        "Generate self\u2011signed cert on first launch",
        "Mutual authentication with peer certificates",
        "Automatic reconnection with exponential back\u2011off",
        "Connection pooling for active peers"
      ]
    },
    {
      "name": "EncryptionService",
      "role": "Wraps all payloads in TLS 1.3 and provides checksum verification for file chunks.",
      "operations": [
        "Encrypt/decrypt message and file data",
        "Generate SHA\u2011256 checksum per chunk",
        "Validate integrity on receipt"
      ]
    },
    {
      "name": "MessagingService",
      "role": "Queues, sends, and receives text messages.",
      "operations": [
        "Queue outgoing messages with retry logic (max 3 attempts, exponential back\u2011off)",
        "Deliver messages to local UI in <200\u202fms",
        "Persist messages to SQLite with timestamp"
      ]
    },
    {
      "name": "FileTransferService",
      "role": "Chunked file transfer with progress reporting.",
      "operations": [
        "Split file into 1\u202fMB chunks",
        "Send chunks over TLS with checksum",
        "Track progress & ETA",
        "Support cancel/abort mid\u2011stream",
        "Persist transfer logs"
      ]
    },
    {
      "name": "StatusService",
      "role": "Broadcasts and consumes user status.",
      "operations": [
        "Send status updates every 30\u202fs",
        "Detect idle state from OS activity APIs",
        "Persist current status across restarts"
      ]
    },
    {
      "name": "PersistenceService",
      "role": "Local storage layer.",
      "storage": "SQLite (encrypted with AES\u2011256 GCM)",
      "tables": [
        "users",
        "messages",
        "files",
        "settings",
        "transfer_logs"
      ],
      "retentionPolicy": {
        "messages": "30\u202fdays",
        "files": "no limit, user\u2011initiated delete only"
      }
    },
    {
      "name": "UI/UX Layer",
      "role": "Cross\u2011platform front\u2011end.",
      "framework": "Flutter (Dart)",
      "features": [
        "Responsive design, native controls per platform",
        "Chat window with timestamps",
        "File transfer progress bar",
        "User list with real\u2011time status",
        "Onboarding wizard for first launch"
      ]
    },
    {
      "name": "NotificationService",
      "role": "System notifications for incoming messages, file transfer status, and errors.",
      "platformSpecifics": {
        "desktop": "Toast/Notification Center",
        "mobile": "Push notifications (local only)"
      }
    }
  ],
  "dataModel": {
    "tables": [
      {
        "name": "users",
        "columns": [
          {
            "name": "id",
            "type": "INTEGER",
            "primaryKey": true
          },
          {
            "name": "display_name",
            "type": "TEXT",
            "unique": true
          },
          {
            "name": "status",
            "type": "TEXT",
            "default": "Online"
          },
          {
            "name": "last_seen",
            "type": "DATETIME"
          }
        ]
      },
      {
        "name": "messages",
        "columns": [
          {
            "name": "id",
            "type": "INTEGER",
            "primaryKey": true
          },
          {
            "name": "conversation_id",
            "type": "INTEGER"
          },
          {
            "name": "sender_id",
            "type": "INTEGER"
          },
          {
            "name": "receiver_id",
            "type": "INTEGER"
          },
          {
            "name": "content",
            "type": "TEXT"
          },
          {
            "name": "timestamp",
            "type": "DATETIME"
          },
          {
            "name": "delivered",
            "type": "BOOLEAN"
          },
          {
            "name": "read",
            "type": "BOOLEAN"
          }
        ]
      },
      {
        "name": "conversations",
        "columns": [
          {
            "name": "id",
            "type": "INTEGER",
            "primaryKey": true
          },
          {
            "name": "peer_id",
            "type": "INTEGER"
          }
        ]
      },
      {
        "name": "files",
        "columns": [
          {
            "name": "id",
            "type": "INTEGER",
            "primaryKey": true
          },
          {
            "name": "conversation_id",
            "type": "INTEGER"
          },
          {
            "name": "sender_id",
            "type": "INTEGER"
          },
          {
            "name": "receiver_id",
            "type": "INTEGER"
          },
          {
            "name": "file_name",
            "type": "TEXT"
          },
          {
            "name": "file_size",
            "type": "INTEGER"
          },
          {
            "name": "chunk_count",
            "type": "INTEGER"
          },
          {
            "name": "status",
            "type": "TEXT"
          },
          {
            "name": "created_at",
            "type": "DATETIME"
          },
          {
            "name": "completed_at",
            "type": "DATETIME",
            "nullable": true
          }
        ]
      },
      {
        "name": "settings",
        "columns": [
          {
            "name": "key",
            "type": "TEXT",
            "primaryKey": true
          },
          {
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ],
    "encryption": "AES\u2011256 GCM for SQLite database files",
    "checksumAlgorithm": "SHA\u2011256"
  },
  "apiDesign": {
    "protocol": "Custom TCP/TLS 1.3",
    "messageFormats": {
      "PresencePacket": {
        "type": "presence",
        "payload": {
          "display_name": "string",
          "status": "string",
          "public_key": "base64",
          "timestamp": "ISO8601"
        }
      },
      "StatusUpdate": {
        "type": "status",
        "payload": {
          "status": "string",
          "timestamp": "ISO8601"
        }
      },
      "ChatMessage": {
        "type": "chat",
        "payload": {
          "conversation_id": "int",
          "sender_id": "int",
          "content": "string",
          "timestamp": "ISO8601"
        }
      },
      "FileMeta": {
        "type": "file_meta",
        "payload": {
          "conversation_id": "int",
          "file_name": "string",
          "file_size": "int",
          "chunk_size": "int",
          "total_chunks": "int",
          "checksum": "hex"
        }
      },
      "FileChunk": {
        "type": "file_chunk",
        "payload": {
          "chunk_index": "int",
          "data": "base64",
          "checksum": "hex"
        }
      },
      "Control": {
        "type": "control",
        "payload": {
          "action": "string",
          "details": "object"
        }
      }
    },
    "endpoints": [
      {
        "name": "SendMessage",
        "method": "POST",
        "path": "/message",
        "requestBody": "ChatMessage",
        "response": "{status: 'queued' | 'failed'}"
      },
      {
        "name": "SendFile",
        "method": "POST",
        "path": "/file/init",
        "requestBody": "FileMeta",
        "response": "{file_id: int}"
      },
      {
        "name": "SendFileChunk",
        "method": "POST",
        "path": "/file/chunk",
        "requestBody": "FileChunk",
        "response": "{chunk_index: int, status: 'ok' | 'checksum_mismatch'}"
      }
    ],
    "security": {
      "tlsVersion": "1.3",
      "mutualAuth": true,
      "certificateStore": "Local keystore per peer"
    }
  },
  "technologyStack": {
    "frontend": {
      "framework": "Flutter (Dart)",
      "uiLibraries": [
        "flutter_bloc",
        "provider",
        "cached_network_image"
      ],
      "nativeIntegrations": [
        "Platform Channels for OS idle detection",
        "Notification plugin"
      ]
    },
    "backend": {
      "runtime": "Dart (VM)",
      "libraries": [
        "dart:io",
        "dart:async",
        "package:mdns",
        "package:tls",
        "package:sqflite",
        "package:path_provider"
      ],
      "crypto": "OpenSSL via dart:io TLS",
      "db": "SQLite (encrypted with sqlcipher)"
    },
    "networking": {
      "discovery": "mDNS / UDP broadcast",
      "transport": "TCP sockets over TLS 1.3",
      "protocol": "Custom JSON\u2011over\u2011TLS"
    },
    "platformTools": {
      "windows": "MSVC, CMake",
      "macos": "Xcode, CocoaPods",
      "linux": "gcc, apt",
      "android": "Gradle, AOSP",
      "ios": "Xcode, CocoaPods"
    },
    "build": {
      "CI": "GitHub Actions",
      "artifact": "AppBundle for each platform"
    }
  },
  "deploymentArchitecture": {
    "model": "Peer\u2011to\u2011peer, no central server",
    "bootstrap": "Optional local host discovery service (mDNS responder) bundled in each client",
    "networkConstraints": "All traffic limited to local subnet (10.0.0.0/8, 192.168.0.0/16, etc.)",
    "resourceLimits": {
      "maxPeers": 50,
      "maxConcurrentTransfers": 5
    },
    "scalabilityPlan": "Each peer runs a lightweight connection manager; no shared state required. For larger clusters, a dedicated local bootstrap node can be deployed to reduce discovery traffic.",
    "securityControls": {
      "firewallRules": "Allow outbound TCP 0\u201165535 to local subnet only",
      "certificateRotation": "Self\u2011signed certs persist for 2\u202fyears or until user deletes the app"
    },
    "maintenance": "No server-side updates; application updates are delivered via standard OS installers (Windows MSI, macOS DMG, Linux DEB/RPM, Android APK, iOS IPA)."
  }
}